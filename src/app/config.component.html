<section class='hero'>
  <p class='eyebrow'>Configuration</p>

  <div class='title-row'>
    <h1>Env Keys</h1>
    <div class='actions'>
      <button type='button' (click)='refresh()' [disabled]='loading()'>
        {{ loading() ? 'Refreshing...' : 'Refresh' }}
      </button>
    </div>
  </div>

  <p class='lead'>
    Keys are stored on Pi5 in a user-owned env file. This page can display full values; keep this dashboard private.
  </p>

  <div class='status' [class.ok]='connected()'>
    <span class='dot' aria-hidden='true'></span>
    <span>{{ statusText() }}</span>
    @if (updatedAt()) {
      <span class='sep' aria-hidden='true'></span>
      <span class='meta'>Updated {{ updatedAt() }}</span>
    }
  </div>

  @if (envPath()) {
    <p class='path'>Source: <code>{{ envPath() }}</code></p>
  }

  @if (toast()) {
    <p class='toast'>{{ toast() }}</p>
  }

  @if (error()) {
    <p class='error'>{{ error() }}</p>
  }

  <div class='links'>
    <a routerLink='/'>Home</a>
    <a routerLink='/todo'>Todo</a>
  </div>
</section>

<section class='grid'>
  @for (entry of entries(); track entry.key) {
    <article class='card' [class.configured]='isConfigured(entry.key)'>
      <div class='card-head'>
        <div class='left'>
          <h2>{{ entry.label }}</h2>
          <p class='key'><code>{{ entry.key }}</code></p>
        </div>
        <div class='right'>
          @if (isDirty(entry.key)) {
            <span class='badge warn'>Unsaved</span>
          }
          <span class='badge' [class.on]='isConfigured(entry.key)'>
            {{ isConfigured(entry.key) ? 'Set' : 'Missing' }}
          </span>
        </div>
      </div>

      <p class='desc'>{{ entry.description }}</p>

      <div class='field'>
        @if (entry.multiline) {
          <textarea
            [value]='draft(entry.key)'
            (input)='setDraft(entry.key, $any($event.target).value)'
            [placeholder]='entry.placeholder ?? ""'
            rows='3'
            spellcheck='false'
          ></textarea>
        } @else {
          <div class='input-row'>
            <input
              [type]='inputType(entry.key, entry)'
              [value]='draft(entry.key)'
              (input)='setDraft(entry.key, $any($event.target).value)'
              [placeholder]='entry.placeholder ?? ""'
              autocomplete='off'
              spellcheck='false'
            />

            @if (entry.sensitive) {
              <button type='button' class='mini' (click)='toggleReveal(entry.key)'>
                {{ reveal(entry.key) ? 'Hide' : 'Show' }}
              </button>
            }

            <button type='button' class='mini' (click)='copy(entry.key)' [disabled]='!draft(entry.key).trim()'>
              Copy
            </button>
          </div>
        }
      </div>

      <div class='card-actions'>
        <button
          type='button'
          (click)='setKey(entry.key)'
          [disabled]='savingKey() === entry.key || !draft(entry.key).trim()'
        >
          Save
        </button>
        <button
          type='button'
          class='danger'
          (click)='clearKey(entry.key)'
          [disabled]='savingKey() === entry.key || !isConfigured(entry.key)'
        >
          Clear
        </button>
      </div>

      @if (savingKey() === entry.key) {
        <p class='saving'>Saving...</p>
      }
    </article>
  }
</section>

<section class='note'>
  <h2>Notes</h2>
  <ul>
    <li>Values are read via the local Pi5 API at <code>/api/config/env</code>.</li>
    <li>The env file is safe to <code>source</code> in shells if desired (it contains <code>export ...</code> lines).</li>
  </ul>
</section>
